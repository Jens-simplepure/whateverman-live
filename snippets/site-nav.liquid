{% comment %}
  Renders the site navigation (Snippet)
  Matches the new base.css structure (Carhartt Style)
  
  Accepts:
  - linklist: The menu handle to render
  - position: 'left' or 'right' (optional, defaults to all)
{% endcomment %}

{%- assign split_index = 10 -%} {% comment %} Zeigt bis zu 10 Links an, bevor gesplittet wird {% endcomment %}

{% for link in linklist.links %}
  {%- assign show_link = false -%}
  
  {%- if position == 'left' -%}
    {%- if forloop.index <= split_index -%}{%- assign show_link = true -%}{%- endif -%}
  {%- elsif position == 'right' -%}
    {%- if forloop.index > split_index -%}{%- assign show_link = true -%}{%- endif -%}
  {%- else -%}
    {%- assign show_link = true -%}
  {%- endif -%}

  {%- if show_link -%}
    <div class="header__nav-item">
      <a href="{{ link.url }}" class="header__nav-link {% if link.active %}is-active{% endif %}">
        {{ link.title }}
        
        {%- comment -%} NEW BADGE {%- endcomment -%}
        {% if link.title contains 'New' or link.title contains 'Neu' %}
          <span class="badge-new">NEW</span>
        {% endif %}
      </a>

      {%- if link.links != blank -%}
        
        {%- comment -%} 
          PrÃ¼fen: Haben wir Level 3 (Unter-Unterkategorien)? 
          Wenn JA -> Spalten-Layout (Columns)
          Wenn NEIN -> Flaches Grid (Flat Grid)
        {%- endcomment -%}
        {%- assign is_level_3 = false -%}
        {%- for child in link.links -%}
          {%- if child.links != blank -%}{%- assign is_level_3 = true -%}{%- break -%}{%- endif -%}
        {%- endfor -%}

        <div class="mega-menu">
          <div class="mega-menu__container">
            
            {%- if is_level_3 -%}
              <div class="mega-menu__columns">
                {%- for childlink in link.links -%}
                  <div class="mega-menu__col">
                    <a href="{{ childlink.url }}" class="mega-menu__heading">{{ childlink.title }}</a>
                    <ul class="mega-menu__list">
                      {%- for grandchild in childlink.links -%}
                        <li>
                          <a href="{{ grandchild.url }}" class="mega-menu__item">{{ grandchild.title }}</a>
                        </li>
                      {%- endfor -%}
                    </ul>
                  </div>
                {%- endfor -%}
              </div>

            {%- else -%}
              <div class="mega-menu__flat-grid">
                {%- for childlink in link.links -%}
                  <a href="{{ childlink.url }}" class="mega-menu__flat-link">
                    {{ childlink.title }}
                    {% if childlink.title contains 'Sale' %}
                      <span style="color:var(--color-sold-out); font-size:0.5em; vertical-align:top;">%</span>
                    {% endif %}
                  </a>
                {%- endfor -%}
              </div>
            {%- endif -%}

          </div>
        </div>
      {%- endif -%}
    </div>
  {%- endif -%}
{% endfor %}