{% comment %}
  Renders the Filter Drawer (CHNGE Style)
  Accepts:
  - results: collection or search object
{% endcomment %}

<div id="FilterDrawer" class="filter-drawer" aria-hidden="true">
  <div class="filter-drawer__overlay" onclick="closeFilterDrawer()"></div>
  <div class="filter-drawer__content">
    
    <div class="filter-drawer__header">
      <h2 class="filter-drawer__title">Filters <span id="FilterCount">[{{ results.filters | map: 'active_values' | map: 'size' | sum }}]</span></h2>
      <button type="button" class="filter-drawer__close" onclick="closeFilterDrawer()">âœ•</button>
    </div>

    <form class="filter-drawer__form" id="FacetFiltersForm">
      {%- if results.terms -%}
        <input type="hidden" name="q" value="{{ results.terms | escape }}">
        <input name="options[prefix]" type="hidden" value="last">
      {%- endif -%}

      <div class="filter-drawer__accordion-list">
        {%- for filter in results.filters -%}
          <div class="filter-group">
            <div class="filter-group__summary">
              <span>{{ filter.label }}</span>
              <span class="filter-group__count"></span>
            </div>
            
            <div class="filter-group__display">
              {%- case filter.type -%}
                {%- when 'boolean' or 'list' -%}
                  <ul class="filter-list {% if filter.label == 'Color' or filter.label == 'Colour' %}filter-list--swatch{% else %}filter-list--chips{% endif %}">
                    {%- for value in filter.values -%}
                      <li class="filter-item">
                        <label class="filter-chip {% if value.active %}is-active{% endif %} {% if value.count == 0 and value.active == false %}is-disabled{% endif %}">
                          <input type="checkbox"
                            name="{{ value.param_name }}"
                            value="{{ value.value }}"
                            {% if value.active %}checked{% endif %}
                            {% if value.count == 0 and value.active == false %}disabled{% endif %}
                            class="visually-hidden"
                            onchange="this.form.submit()"
                          >
                          
                          {% if filter.label == 'Color' or filter.label == 'Colour' %}
                            <span class="color-swatch" style="background-color: {{ value.label | handle }}; background-image: url({{ value.label | handle | append: '.' | append: 'png' | file_url }})"></span>
                            {{ value.label }}
                          {% else %}
                            {{ value.label }}
                          {% endif %}
                        </label>
                      </li>
                    {%- endfor -%}
                  </ul>

                {%- when 'price_range' -%}
                  <div class="filter-price">
                    <div class="filter-price__inputs">
                      <div class="field">
                        <span class="field__currency">{{ cart.currency.symbol }}</span>
                        <input class="field__input"
                          name="{{ filter.min_value.param_name }}"
                          id="Filter-{{ filter.label | escape }}-GTE"
                          {%- if filter.min_value.value -%}
                            value="{{ filter.min_value.value | money_without_currency | replace: ',', '' }}"
                          {%- endif -%}
                          type="number"
                          placeholder="0"
                          min="0"
                          max="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                        >
                      </div>
                      <span class="filter-price__separator">-</span>
                      <div class="field">
                        <span class="field__currency">{{ cart.currency.symbol }}</span>
                        <input class="field__input"
                          name="{{ filter.max_value.param_name }}"
                          id="Filter-{{ filter.label | escape }}-LTE"
                          {%- if filter.max_value.value -%}
                            value="{{ filter.max_value.value | money_without_currency | replace: ',', '' }}"
                          {%- endif -%}
                          type="number"
                          placeholder="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                          min="0"
                          max="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                        >
                      </div>
                    </div>
                  </div>
              {%- endcase -%}
            </div>
          </div>
        {%- endfor -%}
      </div>

      <div class="filter-drawer__footer">
        <a href="{{ results.url }}?sort_by={{ results.sort_by }}" class="btn btn-outline btn-full">Clear Filters</a>
        <button type="submit" class="btn btn-primary btn-full">See Results</button>
      </div>
    </form>
  </div>
</div>

<script>
  function openFilterDrawer() {
    document.getElementById('FilterDrawer').classList.add('is-open');
    document.body.style.overflow = 'hidden';
  }
  function closeFilterDrawer() {
    document.getElementById('FilterDrawer').classList.remove('is-open');
    document.body.style.overflow = '';
  }
</script>