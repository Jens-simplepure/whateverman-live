{% comment %}
  CHNGE Style Filter Drawer - DARK MODE (Matching Bag Drawer)
{% endcomment %}

<div id="FilterDrawer" class="filter-drawer" aria-hidden="true">
  <div class="filter-drawer__overlay" onclick="closeFilterDrawer()"></div>
  <div class="filter-drawer__content">
    
    <div class="filter-drawer__header">
      <h2 class="filter-drawer__title">FILTERS <span class="filter-count">[{{ results.products_count }}]</span></h2>
      <button type="button" class="filter-drawer__close" onclick="closeFilterDrawer()">âœ•</button>
    </div>

    <form class="filter-drawer__form" id="FacetFiltersForm">
      {%- if results.terms -%}
        <input type="hidden" name="q" value="{{ results.terms | escape }}">
      {%- endif -%}

      <div class="filter-drawer__accordion-list">
        {%- for filter in results.filters -%}
          <div class="filter-group">
            <div class="filter-group__summary">
              <span>{{ filter.label }}</span>
            </div>
            
            <div class="filter-group__display">
              {%- case filter.type -%}
                {%- when 'boolean' or 'list' -%}
                  <ul class="filter-list {% if filter.label == 'Color' or filter.label == 'Farbe' %}filter-list--swatch{% else %}filter-list--chips{% endif %}">
                    {%- for value in filter.values -%}
                      <li class="filter-item">
                        <label class="filter-chip {% if value.active %}is-active{% endif %} {% if value.count == 0 and value.active == false %}is-disabled{% endif %}">
                          <input type="checkbox"
                            name="{{ value.param_name }}"
                            value="{{ value.value }}"
                            {% if value.active %}checked{% endif %}
                            {% if value.count == 0 and value.active == false %}disabled{% endif %}
                            class="visually-hidden"
                            onchange="this.closest('form').submit()"
                          >
                          
                          {% if filter.label == 'Color' or filter.label == 'Farbe' %}
                            <span class="color-swatch" style="background-color: {{ value.label | handle }};"></span>
                            {{ value.label }}
                          {% else %}
                            {{ value.label }}
                          {% endif %}
                        </label>
                      </li>
                    {%- endfor -%}
                  </ul>

                {%- when 'price_range' -%}
                  <div class="filter-price-group">
                    <div class="field">
                      <span class="currency-symbol">{{ cart.currency.symbol }}</span>
                      <input class="field__input"
                        name="{{ filter.min_value.param_name }}"
                        type="number"
                        placeholder="0"
                        min="0"
                        max="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                        {% if filter.min_value.value %}value="{{ filter.min_value.value | money_without_currency | replace: ',', '' }}"{% endif %}
                      >
                    </div>
                    <span class="price-separator">-</span>
                    <div class="field">
                      <span class="currency-symbol">{{ cart.currency.symbol }}</span>
                      <input class="field__input"
                        name="{{ filter.max_value.param_name }}"
                        type="number"
                        min="0"
                        max="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                        {% if filter.max_value.value %}value="{{ filter.max_value.value | money_without_currency | replace: ',', '' }}"{% endif %}
                      >
                    </div>
                  </div>
                  <button type="submit" class="btn-price-apply">APPLY PRICE</button>
              {%- endcase -%}
            </div>
          </div>
        {%- endfor -%}
      </div>

      <div class="filter-drawer__footer">
        <a href="{{ results.url }}?sort_by={{ results.sort_by }}" class="btn btn-outline btn-full">CLEAR ALL</a>
        <button type="button" class="btn btn-gradient btn-full" onclick="closeFilterDrawer()">VIEW RESULTS</button>
      </div>
    </form>
  </div>
</div>

<script>
  function openFilterDrawer() {
    document.getElementById('FilterDrawer').classList.add('is-open');
    document.body.style.overflow = 'hidden';
  }
  function closeFilterDrawer() {
    document.getElementById('FilterDrawer').classList.remove('is-open');
    document.body.style.overflow = '';
  }
</script>

<style>
  /* --- DRAWER CONTAINER (DARK THEME) --- */
  .filter-drawer { position: fixed; inset: 0; z-index: 2000; visibility: hidden; pointer-events: none; }
  .filter-drawer.is-open { visibility: visible; pointer-events: auto; }
  
  .filter-drawer__overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.8); opacity: 0; transition: opacity 0.3s; backdrop-filter: blur(2px); }
  .filter-drawer.is-open .filter-drawer__overlay { opacity: 1; }
  
  .filter-drawer__content {
    position: absolute; top: 0; right: 0; bottom: 0; width: 100%; max-width: 400px;
    background: #000000; /* BLACK BACKGROUND like Bag */
    transform: translateX(100%); transition: transform 0.3s cubic-bezier(0.165, 0.84, 0.44, 1);
    display: flex; flex-direction: column;
    border-left: 1px solid rgba(255,255,255,0.1);
  }
  .filter-drawer.is-open .filter-drawer__content { transform: translateX(0); }
  
  /* --- HEADER --- */
  .filter-drawer__header { 
    padding: 1.5rem 2rem; 
    display: flex; justify-content: space-between; align-items: center; 
    border-bottom: 1px solid rgba(255,255,255,0.1); 
  }
  .filter-drawer__title { 
    margin: 0; font-family: 'Bebas Neue', sans-serif; font-size: 1.8rem; letter-spacing: 0.05em; color: #fff; 
  }
  .filter-count { color: #666; font-size: 1rem; vertical-align: middle; margin-left: 5px; font-family: 'Inter', sans-serif; }
  .filter-drawer__close { 
    background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #fff; transition: color 0.2s;
  }
  .filter-drawer__close:hover { color: var(--color-primary); }
  
  /* --- CONTENT --- */
  .filter-drawer__form { flex: 1; overflow-y: auto; padding: 1.5rem 2rem; }
  
  .filter-group { margin-bottom: 2rem; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 2rem; }
  .filter-group:last-child { border-bottom: none; }
  
  .filter-group__summary { 
    font-family: 'Inter', sans-serif; font-weight: 600; font-size: 1rem; margin-bottom: 1rem; color: #fff; display: block; text-transform: uppercase; letter-spacing: 0.05em;
  }
  
  /* --- CHIPS STYLE (DARK MODE) --- */
  .filter-list--chips, .filter-list--swatch { list-style: none; padding: 0; margin: 0; display: flex; flex-wrap: wrap; gap: 0.8rem; }
  
  .filter-chip {
    display: inline-flex; align-items: center; justify-content: center; gap: 8px;
    padding: 0.6rem 1.2rem;
    background: #111; /* Dark Grey */
    border: 1px solid rgba(255,255,255,0.2); 
    border-radius: 4px;
    font-family: 'Inter', sans-serif; font-size: 0.9rem; color: #fff; 
    cursor: pointer; transition: all 0.2s; user-select: none;
  }
  
  .filter-chip:hover { border-color: #fff; }
  
  /* ACTIVE STATE -> NEON GREEN (Brand Identity) */
  .filter-chip.is-active { 
    background: var(--color-primary, #aaff00); 
    color: #000; 
    border-color: var(--color-primary, #aaff00); 
    font-weight: 600;
  }
  .filter-chip.is-disabled { opacity: 0.3; pointer-events: none; text-decoration: line-through; }
  
  /* COLOR SWATCHES */
  .color-swatch {
    width: 14px; height: 14px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.2);
  }
  
  /* --- PRICE INPUTS --- */
  .filter-price-group { display: flex; gap: 10px; align-items: center; margin-bottom: 10px; }
  .field { position: relative; flex: 1; display: flex; align-items: center; background: #111; border: 1px solid rgba(255,255,255,0.2); border-radius: 4px; padding: 0 10px; }
  .currency-symbol { color: #666; font-size: 0.9rem; }
  .field__input { 
    width: 100%; background: transparent; border: none; color: #fff; padding: 10px 5px; font-family: 'Inter', sans-serif; outline: none;
  }
  .price-separator { color: #666; }
  .btn-price-apply {
    margin-top: 10px; background: #333; color: #fff; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-size: 0.8rem; text-transform: uppercase;
  }
  .btn-price-apply:hover { background: #fff; color: #000; }

  /* --- FOOTER BUTTONS --- */
  .filter-drawer__footer { 
    padding: 1.5rem 2rem; background: #000; 
    border-top: 1px solid rgba(255,255,255,0.1); 
    display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; 
  }
  
  .btn-full { width: 100%; padding: 1rem; text-align: center; font-family: 'Bebas Neue', sans-serif; letter-spacing: 0.05em; font-size: 1.1rem; }
  
  /* Outline Button (Clear) */
  .filter-drawer .btn-outline { 
    border: 1px solid #fff; color: #fff; background: transparent; 
  }
  .filter-drawer .btn-outline:hover { background: #fff; color: #000; }
  
  /* Gradient Button (View Results - Matching Checkout) */
  .filter-drawer .btn-gradient { 
    background: linear-gradient(135deg, var(--color-primary, #aaff00), var(--color-accent, #ff4400)); 
    color: #000; border: none; 
  }
  .filter-drawer .btn-gradient:hover { 
    opacity: 0.9; transform: translateY(-1px);
  }
</style>